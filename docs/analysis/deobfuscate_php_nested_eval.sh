#!/bin/sh
if [ -z $1 ]; then
    echo
    echo "USAGE:  $0  path/to/License.php"
    echo
    exit 99
fi
echo
echo "WARNING: This script will execute code from '$1' as user 'nobody'."
echo -n "Press enter to continue."
read x
echo
DEST="$1.dec.php"
cp "$1" "$DEST"
while egrep -q 'eval\((str_rot13|gzinflate|base64_decode|gzuncompress)\(' "$DEST"; do
    # Vladimir Popov's trick
    sed -i "s/eval(base64_decode('JF9WPWd6aW5mbGF0ZShiYXNlNjRfZGVjb2RlKCRfVikpOyRfVj1zdHJ0cigkX1YsJzEyMzQ1NnZsYWRpJywndmxhZGkxMjM0NTYnKTtldmFsKCRfVik7'));/\$_V=gzinflate(base64_decode(\$_V));\$_V=strtr(\$_V,'123456vladi','vladi123456');eval(\$_V);/" "$DEST"
    #
    echo "<?php $( cat "$DEST" | sed 's/eval(/echo(/g' | sudo -u nobody php )" > "$DEST"
    echo -n "."
done
echo
cat "$DEST"
